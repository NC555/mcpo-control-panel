<!-- ================================================ -->
<!-- FILE: src/mcp_manager_ui/ui/templates/index.html -->
<!-- (Удалена секция логов, остальное без изменений с прошлого шага) -->
<!-- ================================================ -->
{% extends "base.html" %}

{% block title %}Управление серверами - MCP Менеджер{% endblock %}
{% block page_title %}Серверы и Управление MCPO{% endblock %}
{% block page_subtitle %}Обзор определений MCP серверов и контроль процесса mcpo{% endblock %}

{% block content %}

<!-- Секция управления MCPO -->
<div class="row">
    <div class="col s12">
        <div class="card blue-grey lighten-5">
            <div class="card-content">
                <span class="card-title blue-grey-text text-darken-3">Управление процессом MCPO</span>
                <div id="mcpo-status-block"
                     hx-get="{{ url_for('get_mcpo_process_status_html') }}"
                     hx-trigger="load, every 5s"
                     hx-target="this"
                     hx-swap="innerHTML"
                     class="blue-grey-text text-darken-2">
                    <p>Загрузка статуса...</p>
                </div>
            </div>
            <div class="card-action">
                <button hx-post="{{ url_for('start_mcpo_process') }}" hx-target="#mcpo-status-block" hx-swap="innerHTML" hx-indicator="#mcpo-spinner" class="btn waves-effect waves-light green darken-1">
                    <i class="material-icons left">play_arrow</i>Запустить MCPO
                </button>
                <button hx-post="{{ url_for('stop_mcpo_process') }}" hx-target="#mcpo-status-block" hx-swap="innerHTML" hx-indicator="#mcpo-spinner" class="btn waves-effect waves-light red darken-1">
                    <i class="material-icons left">stop</i>Остановить MCPO
                </button>
                <button hx-post="{{ url_for('restart_mcpo_process') }}" hx-target="#mcpo-status-block" hx-swap="innerHTML" hx-indicator="#mcpo-spinner" class="btn waves-effect waves-light orange darken-1">
                    <i class="material-icons left">refresh</i>Применить и Перезапустить
                </button>
                <div id="mcpo-spinner" class="htmx-indicator preloader-wrapper small active" style="vertical-align: middle; margin-left: 10px; width: 24px; height: 24px;">
                    <div class="spinner-layer spinner-blue-only">
                        <div class="circle-clipper left"><div class="circle"></div></div>
                        <div class="gap-patch"><div class="circle"></div></div>
                        <div class="circle-clipper right"><div class="circle"></div></div>
                    </div>
                </div>
            </div>
            <!-- Настройки в Collapsible (логи УБРАНЫ отсюда) -->
            <div class="card-content" style="padding-top: 0;">
                <ul class="collapsible">
                     <li>
                        <div class="collapsible-header">
                            <i class="material-icons">tune</i>Текущие настройки MCPO
                            <a href="{{ url_for('ui_edit_mcpo_settings_form') }}" class="secondary-content tooltipped" data-position="top" data-tooltip="Редактировать настройки">
                                <i class="material-icons blue-grey-text">edit</i>
                            </a>
                        </div>
                        <div class="collapsible-body blue-grey-text text-darken-2" style="line-height: 1.8;">
                             <span>Порт: <code>{{ mcpo_settings.port }}</code></span><br>
                             <span>Исп. API ключ: <code>{{ 'Да' if mcpo_settings.use_api_key else 'Нет' }}</code></span><br>
                             <span>API Ключ: <code>{{ mcpo_settings.api_key if mcpo_settings.use_api_key and mcpo_settings.api_key else 'Не используется / Не задан' }}</code></span><br>
                             <span>Путь к конфигу: <code>{{ mcpo_settings.config_file_path }}</code></span><br>
                             <span>Путь к логам: <code>{{ mcpo_settings.log_file_path if mcpo_settings.log_file_path else 'Не задан' }}</code></span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>


<!-- Секция списка серверов (без изменений) -->
<div class="row" style="margin-top: 30px;">
    <div class="col s12">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
             <h5 class="blue-grey-text text-darken-2" style="margin: 0;">Определения серверов</h5>
             <a href="{{ url_for('ui_bulk_add_form') }}" class="btn-small waves-effect waves-light blue darken-1 tooltipped" data-position="top" data-tooltip="Добавить несколько серверов из JSON">
                 <i class="material-icons left">add_circle_outline</i>Массовое добавление
             </a>
         </div>
        <table class="highlight responsive-table">
            <thead>
                <tr>
                    <th style="width: 5%;">Вкл.</th>
                    <th>Имя</th>
                    <th>Тип</th>
                    <th>Детали</th>
                    <th style="width: 15%;">Действия</th>
                </tr>
            </thead>
            <tbody id="server-list-body">
                {% for server in server_definitions %}
                    {% include "_server_row.html" %}
                {% else %}
                    <tr>
                        <td colspan="5" class="center-align grey-text">
                            Определения серверов не найдены.
                             <a href="{{ url_for('ui_bulk_add_form') }}">Добавить через JSON?</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}